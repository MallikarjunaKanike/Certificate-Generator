<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="https://assets.sophos.com/X24WTUEQ/at/f6g64jm83q76jk8p8xwh83fc/sophos-logo-white.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sophos CTF Certificate Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&family=Montserrat:wght@400;500;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Montserrat', sans-serif;
      }
      .font-serif-display {
        font-family: 'Merriweather', serif;
      }
      .font-script {
        font-family: 'Dancing Script', cursive;
      }
      @page {
        size: A4 landscape;
        margin: 0;
      }
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }

        /* Hide everything by default */
        body * {
          visibility: hidden;
        }

        /* Make the certificate container and its children visible */
        #certificate-print-area, #certificate-print-area * {
          visibility: visible;
        }

        /* Position the certificate container to fill the page */
        #certificate-print-area {
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          transform: scale(1) !important; /* Override inline style */
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 0;
          margin: 0;
          box-shadow: none !important;
        }
      }
    </style>
  <link rel="stylesheet" href="/index.css">
</head>
  <body class="bg-gray-900 text-white">
    <div id="root"></div>

    <!-- Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- React Application Logic -->
    <script type="text/babel">
      const { useState, useCallback, useEffect, useRef } = React;

      // From types.ts
      const CertificateType = {
        WINNER: 'Winner',
        PARTICIPANT: 'Participant',
      };

      // From components/Certificate.tsx
      const SophosLogo = () => (
          <img 
              src="https://assets.sophos.com/X24WTUEQ/at/cgwpbfck63x7s6xnn84ck/Logo-Graphic-Logo-Tagline.svg" 
              alt="Sophos Logo"
              className="h-16"
              crossOrigin="anonymous"
          />
      );

      const Certificate = ({ 
        name, 
        certificateType, 
        eventDate,
        title,
        presentedToText,
        description,
        eventName,
        signatory1Name,
        signatory1Title,
        signatory2Name,
        signatory2Title,
        heldOnText,
        signatory1Signature,
        signatory2Signature,
        formattedIssuedOnDate,
      }) => {
        return (
          <div 
               id="certificate-to-capture"
               className="w-[1123px] h-[794px] bg-white text-gray-800 p-10 flex flex-col justify-between" 
               style={{
                 backgroundImage: 'url("data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23e0f2fe\' fill-opacity=\'0.4\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")',
                 border: '10px solid',
                 borderImageSource: 'linear-gradient(to right, #00529b, #0078d4)',
                 borderImageSlice: 1,
                 position: 'relative',
                 overflow: 'hidden'
               }}>
            
            <img 
              src="https://assets.sophos.com/X24WTUEQ/at/8g29hjmqw4bnxqgcpxnhf43x/Logo-Shield-Graphic.svg" 
              alt="Sophos Watermark"
              className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[450px] h-[450px] opacity-10 pointer-events-none"
            />

            <div className="flex justify-between items-start z-10">
              <SophosLogo />
              <div className="text-right">
                <p className="font-semibold text-gray-600">Issued On</p>
                <p className="text-lg">{formattedIssuedOnDate}</p>
              </div>
            </div>
            
            <div className="text-center z-10">
              <h1 className="font-serif-display text-5xl font-bold text-blue-800 mb-4">{title}</h1>
              <p className="text-xl text-gray-600 mb-6">{presentedToText}</p>
              <p className="font-script text-7xl text-gray-900 px-4 border-b-2 border-gray-400 inline-block pb-2">
                {name || 'Participant Name'}
              </p>
              <p className="text-lg text-gray-600 mt-8 max-w-3xl mx-auto">
                {description}
              </p>
              <p className="font-serif-display text-4xl font-extrabold text-gray-800 mt-4">
                {eventName}
              </p>
              {heldOnText && <p className="text-lg text-gray-500 mt-2">{heldOnText}</p>}
            </div>
            
            <div className="flex justify-around items-end text-center z-10">
              <div className="w-1/3">
                <div className="h-16 flex justify-center items-center mb-2">
                  {signatory1Signature ? (
                    <img src={signatory1Signature} alt={`${signatory1Name}'s signature`} className="max-h-full max-w-full object-contain" />
                  ) : (
                    <p className="font-script text-3xl">{signatory1Name}</p>
                  )}
                </div>
                <p className="border-t-2 border-gray-400 pt-2 font-semibold text-gray-600">{signatory1Name}</p>
                <p className="font-semibold text-gray-600">{signatory1Title}</p>
              </div>
              
              <div className="w-1/3">
                <div className="h-16 flex justify-center items-center mb-2">
                  {signatory2Signature ? (
                    <img src={signatory2Signature} alt={`${signatory2Name}'s signature`} className="max-h-full max-w-full object-contain" />
                  ) : (
                    <p className="font-script text-3xl">{signatory2Name}</p>
                  )}
                </div>
                <p className="border-t-2 border-gray-400 pt-2 font-semibold text-gray-600">{signatory2Name}</p>
                <p className="font-semibold text-gray-600">{signatory2Title}</p>
              </div>
            </div>
      
          </div>
        );
      };

      // From components/Controls.tsx
      const InputField = ({ label, value, onChange, type = 'text', placeholder }) => (
        <div>
          <label className="block text-sm font-medium text-gray-400 mb-2">{label}</label>
          <input
            type={type}
            value={value}
            onChange={onChange}
            placeholder={placeholder || `Enter ${label.toLowerCase()}`}
            className="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"
            {...(type === 'date' && { style: { colorScheme: 'dark' } })}
          />
        </div>
      );

      const ImageUploadField = ({ label, onUpload, onClear, previewUrl }) => {
        const fileInputRef = useRef(null);

        const handleFileChange = (e) => {
          const file = e.target.files?.[0];
          if (file) {
            const reader = new FileReader();
            reader.onloadend = () => {
              onUpload(reader.result);
            };
            reader.readAsDataURL(file);
          }
        };
        
        const triggerFileInput = () => {
            fileInputRef.current?.click();
        };

        return (
          <div>
            <label className="block text-sm font-medium text-gray-400 mb-2">{label}</label>
            <div className="flex items-center space-x-4">
              <input
                type="file"
                accept="image/png, image/jpeg, image/svg+xml"
                onChange={handleFileChange}
                ref={fileInputRef}
                className="hidden"
              />
              <button onClick={triggerFileInput} className="bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold py-2 px-4 rounded-lg text-sm transition duration-200">
                  {previewUrl ? 'Change' : 'Upload'}
              </button>
              {previewUrl && (
                <div className="flex items-center space-x-2 p-1 bg-gray-600 rounded">
                  <img src={previewUrl} alt="Signature preview" className="h-10 bg-white p-1 rounded-sm object-contain"/>
                  <button onClick={onClear} className="text-gray-400 hover:text-white font-bold text-xl pr-2">&times;</button>
                </div>
              )}
            </div>
          </div>
        );
      };


      const Controls = ({ 
        name, setName, 
        certificateType, setCertificateType, 
        handlePrint,
        eventDate, setEventDate,
        issuedOnDate, setIssuedOnDate,
        title, setTitle,
        presentedToText, setPresentedToText,
        description, setDescription,
        eventName, setEventName,
        signatory1Name, setSignatory1Name,
        signatory1Title, setSignatory1Title,
        signatory2Name, setSignatory2Name,
        signatory2Title, setSignatory2Title,
        heldOnText, setHeldOnText,
        signatory1Signature, setSignatory1Signature,
        signatory2Signature, setSignatory2Signature,
      }) => {
        return (
          <div className="w-full h-full flex flex-col">
            <div className="flex items-center space-x-3 mb-8 flex-shrink-0">
              <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              <h1 className="text-2xl font-bold text-gray-100">Certificate Editor</h1>
            </div>
            
            <div className="space-y-6 overflow-y-auto pr-4 -mr-4 flex-grow">
              <details open>
                <summary className="cursor-pointer text-lg font-semibold text-gray-300 hover:text-white">Core Details</summary>
                <div className="space-y-4 pt-4">
                  <InputField label="Participant's Full Name" value={name} onChange={(e) => setName(e.target.value)} />
                  <InputField label="Event Date" value={eventDate} onChange={(e) => setEventDate(e.target.value)} type="date" />
                  <InputField label="Issued On Date" value={issuedOnDate} onChange={(e) => setIssuedOnDate(e.target.value)} type="date" />
                   <div>
                    <label className="block text-sm font-medium text-gray-400 mb-2">Certificate Type</label>
                    <div className="grid grid-cols-2 gap-4">
                      <button
                        onClick={() => setCertificateType(CertificateType.WINNER)}
                        className={`px-4 py-3 rounded-lg text-sm font-semibold transition duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 ${certificateType === CertificateType.WINNER ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}
                      >Winner</button>
                      <button
                        onClick={() => setCertificateType(CertificateType.PARTICIPANT)}
                        className={`px-4 py-3 rounded-lg text-sm font-semibold transition duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500 ${certificateType === CertificateType.PARTICIPANT ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}
                      >Participant</button>
                    </div>
                  </div>
                </div>
              </details>

              <details>
                <summary className="cursor-pointer text-lg font-semibold text-gray-300 hover:text-white">Certificate Text</summary>
                <div className="space-y-4 pt-4">
                  <InputField label="Title" value={title} onChange={(e) => setTitle(e.target.value)} />
                  <InputField label="'Presented To' Text" value={presentedToText} onChange={(e) => setPresentedToText(e.target.value)} />
                  <InputField label="Description" value={description} onChange={(e) => setDescription(e.target.value)} />
                  <InputField label="Event Name" value={eventName} onChange={(e) => setEventName(e.target.value)} />
                  <InputField label="Date Text" value={heldOnText} onChange={(e) => setHeldOnText(e.target.value)} />
                </div>
              </details>

              <details>
                <summary className="cursor-pointer text-lg font-semibold text-gray-300 hover:text-white">Signatories</summary>
                <div className="space-y-4 pt-4">
                  <div className="p-4 border border-gray-700 rounded-lg space-y-4">
                    <ImageUploadField label="Signatory 1 Signature" previewUrl={signatory1Signature} onUpload={setSignatory1Signature} onClear={() => setSignatory1Signature('')}/>
                    <InputField label="Signatory 1 Name" value={signatory1Name} onChange={(e) => setSignatory1Name(e.target.value)} />
                    <InputField label="Signatory 1 Title" value={signatory1Title} onChange={(e) => setSignatory1Title(e.target.value)} />
                  </div>
                   <div className="p-4 border border-gray-700 rounded-lg space-y-4">
                    <ImageUploadField label="Signatory 2 Signature" previewUrl={signatory2Signature} onUpload={setSignatory2Signature} onClear={() => setSignatory2Signature('')}/>
                    <InputField label="Signatory 2 Name" value={signatory2Name} onChange={(e) => setSignatory2Name(e.target.value)} />
                    <InputField label="Signatory 2 Title" value={signatory2Title} onChange={(e) => setSignatory2Title(e.target.value)} />
                  </div>
                </div>
              </details>
            </div>
            
            <div className="mt-8 flex-shrink-0">
               <button
                onClick={handlePrint}
                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center space-x-2 transition duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500"
              >
                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                <span>Print Certificate</span>
              </button>
            </div>
          </div>
        );
      };

      // From App.tsx
      function App() {
        const [name, setName] = useState('Jane Doe');
        const [certificateType, setCertificateType] = useState(CertificateType.WINNER);
        const [eventDate, setEventDate] = useState(new Date().toISOString().split('T')[0]);
        const [issuedOnDate, setIssuedOnDate] = useState(new Date().toISOString().split('T')[0]);
        
        const [title, setTitle] = useState('');
        const [presentedToText, setPresentedToText] = useState('Proudly Presented To');
        const [description, setDescription] = useState('');
        const [eventName, setEventName] = useState('Pacific Thunder CTF III Challenge');
        const [signatory1Name, setSignatory1Name] = useState('John Security');
        const [signatory1Title, setSignatory1Title] = useState('CTF Organizer');
        const [signatory2Name, setSignatory2Name] = useState('Jane Crypton');
        const [signatory2Title, setSignatory2Title] = useState('Head of Sophos Labs');
        const [heldOnText, setHeldOnText] = useState('');
        const [formattedIssuedOnDate, setFormattedIssuedOnDate] = useState('');
        const [signatory1Signature, setSignatory1Signature] = useState('');
        const [signatory2Signature, setSignatory2Signature] = useState('');

        const certificatePreviewRef = useRef(null);
        const [scale, setScale] = useState(1);

        useEffect(() => {
            const previewEl = certificatePreviewRef.current;
            if (!previewEl) return;

            const observer = new ResizeObserver(() => {
                const { width, height } = previewEl.getBoundingClientRect();
                const A4_WIDTH = 1123;
                const A4_HEIGHT = 794;
                
                const PADDING = 64; // Corresponds to p-8 on two sides
                const scaleX = (width - PADDING) / A4_WIDTH;
                const scaleY = (height - PADDING) / A4_HEIGHT;
                
                // Don't scale up beyond 100%
                setScale(Math.min(scaleX, scaleY, 1));
            });

            observer.observe(previewEl);
            return () => observer.disconnect();
        }, []);


        useEffect(() => {
          const isWinner = certificateType === CertificateType.WINNER;
          setTitle(isWinner ? 'Certificate of Achievement' : 'Certificate of Participation');
          setDescription(isWinner 
            ? 'For their outstanding performance and securing a winning position in' 
            : 'For their valuable contribution and active participation in');
        }, [certificateType]);
        
        useEffect(() => {
          if (!eventDate) {
            setHeldOnText('');
            return;
          }
          const [year, month, day] = eventDate.split('-').map(Number);
          const date = new Date(Date.UTC(year, month - 1, day));
          const formattedDate = date.toLocaleDateString('en-US', { timeZone: 'UTC', year: 'numeric', month: 'long', day: 'numeric' });
          setHeldOnText(`Held on ${formattedDate}`);
        }, [eventDate]);

        useEffect(() => {
          if (!issuedOnDate) {
            setFormattedIssuedOnDate('');
            return;
          }
          const [year, month, day] = issuedOnDate.split('-').map(Number);
          const date = new Date(Date.UTC(year, month - 1, day));
          const formattedDate = date.toLocaleDateString('en-US', { timeZone: 'UTC', year: 'numeric', month: 'long', day: 'numeric' });
          setFormattedIssuedOnDate(formattedDate);
        }, [issuedOnDate]);

        const handlePrint = useCallback(() => {
          window.print();
        }, []);

        return (
          <div className="h-screen bg-gray-900 text-white flex flex-col lg:flex-row overflow-hidden">
            <div className="w-full lg:w-[450px] lg:flex-shrink-0">
               <div className="h-full bg-gray-800 border-r border-gray-700 p-8 overflow-y-auto">
                <Controls
                  name={name}
                  setName={setName}
                  certificateType={certificateType}
                  setCertificateType={setCertificateType}
                  handlePrint={handlePrint}
                  eventDate={eventDate}
                  setEventDate={setEventDate}
                  issuedOnDate={issuedOnDate}
                  setIssuedOnDate={setIssuedOnDate}
                  title={title}
                  setTitle={setTitle}
                  presentedToText={presentedToText}
                  setPresentedToText={setPresentedToText}
                  description={description}
                  setDescription={setDescription}
                  eventName={eventName}
                  setEventName={setEventName}
                  signatory1Name={signatory1Name}
                  setSignatory1Name={setSignatory1Name}
                  signatory1Title={signatory1Title}
                  setSignatory1Title={setSignatory1Title}
                  signatory2Name={signatory2Name}
                  setSignatory2Name={setSignatory2Name}
                  signatory2Title={signatory2Title}
                  setSignatory2Title={setSignatory2Title}
                  heldOnText={heldOnText}
                  setHeldOnText={setHeldOnText}
                  signatory1Signature={signatory1Signature}
                  setSignatory1Signature={setSignatory1Signature}
                  signatory2Signature={signatory2Signature}
                  setSignatory2Signature={setSignatory2Signature}
                />
              </div>
            </div>
            <div ref={certificatePreviewRef} id="certificate-wrapper" className="flex-grow flex items-center justify-center p-4 lg:p-8 overflow-hidden">
                <div id="certificate-print-area" 
                    className="w-[1123px] h-[794px] flex-shrink-0 shadow-2xl"
                    style={{ transform: `scale(${scale})`, transformOrigin: 'center' }}
                >
                    <Certificate 
                        name={name} 
                        certificateType={certificateType} 
                        eventDate={eventDate}
                        title={title}
                        presentedToText={presentedToText}
                        description={description}
                        eventName={eventName}
                        signatory1Name={signatory1Name}
                        signatory1Title={signatory1Title}
                        signatory2Name={signatory2Name}
                        signatory2Title={signatory2Title}
                        heldOnText={heldOnText}
                        signatory1Signature={signatory1Signature}
                        signatory2Signature={signatory2Signature}
                        formattedIssuedOnDate={formattedIssuedOnDate}
                    />
                </div>
            </div>
          </div>
        );
      }

      // From index.tsx
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(<App />);

    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>